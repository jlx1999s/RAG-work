目的是开发一个垂直领域专家智能体
rag部分的设计：
1.向量数据库使用milvus
2.需要对文档进行预处理，包括语义切分、向量化、存储等，文件支持pdf、docx，pdf使用mineru提取
3.检索召回使用混合检索和rerank二次排序
4.模型支持openai格式，方便后续切换模型
5.使用langgraph搭建
6.两种rag模式：1.lightrag2.向量数据库rag，使用milvs。后续问答时根据问题，判断从哪个rag进行检索；也可以用户自行选择使用哪种模式
7.检索前根据用户问题生成相关问题，一起去检索

整体设计：
1.后端使用fastapi，前端使用react，数据库使用pgsql
2.agent部分使用langgraph

D:.\project\backend
├─agent
│  ├─graph
│  └─tools
├─api
│  └─routers
├─rag
│  ├─chunks
│  ├─retriever
│  └─storage
├─services
└─tests

分块后返回1.分块list2.对应的文档名称

milvus设计
来存储分块后的文本，支持混合检索（BM25 + 向量检索）。需要包含的字段：
1. 分块文本本身
2. 对应的向量
3. 分块的文档名称

对于混合检索，需要考虑：
1. 向量字段用于向量相似度搜索
2. 文本字段用于 BM25 全文检索
3. 文档名称用于过滤和组织
4. 可能还需要一些元数据字段

schema结构：
1. 主键字段 (chunk_id)
- 类型：INT64
- 自动生成ID
- 用于唯一标识每个文本块
2. 文本字段 (text_content)
- 类型：VARCHAR
- 存储分块后的文本内容
- 用于BM25全文检索
3. 向量字段 (embedding)
- 类型：FLOAT_VECTOR
- 存储文本的向量表示
- 用于相似度搜索
4. 文档名字段 (document_name)
- 类型：VARCHAR
- 存储原文档名称
- 用于过滤和组织
5. 元数据字段
- chunk_index：块在文档中的序号
- chunk_size：块的字符数


索引设计策略

1. 向量索引
针对embedding字段：
推荐索引类型：
- HNSW：高性能，适合实时查询
- IVF_FLAT：平衡性能和精度
- IVF_PQ：内存优化版本

相似度度量：
- COSINE：适合文本嵌入
- IP：内积距离
- L2：欧几里得距离

 2. 全文检索索引（BM25）

针对text_content字段：
Milvus 2.6支持全文检索，需要：
- 启用BM25分词器
- 配置中文分词（如果需要）
- 设置停用词表

3. 标量字段索引
针对document_name字段：
- 创建INVERTED索引用于快速过滤

rag后端接口
1.文档预处理接口：上传文档，先进行文件提取，若是pdf文件使用mineruapi提取，若是docx文件使用python-docx提取（文件提取这一块可以做成一个类）；处理后对文本进行切块，支持自定义的分块策略，包括递归切块，语义分块，固定长度分块，agentic chunk（分块部分写成一个类）；返回分块结果。
2.向量化接口：接受分块后的文本，调用embedding模型进行向量化，并存入milvus
3.检索接口：接受用户查询，调用embedding模型进行向量化，从milvus中检索出最相关的文本块，返回检索结果。

agent相关接口
1.配置chatmodel接口
2.配置embedding模型接口


raggraph图结构
---
config:
  theme: redux
  layout: dagre
---
flowchart TD
    A(["开始"]) --> n2["是否需要检索"]
    B{"判断原始问题类型"} --> C["适合使用向量数据库"] & D["适合使用图数据库"]
    n1["由原始问题扩展子问题"] --> B
    n2 -- 是 --> n1
    C --> n4["检索出的文档是否具有相关性"]
    D --> n4
    n4 -- 否 --> n5["使用网络爬虫工具"]
    n4 -- 是 --> n6["生成答案结点"]
    n6 --> n3["结束"]
    n2 --> n3
    n5 --> n6
    n2@{ shape: diam}
    n1@{ shape: rounded}
    n4@{ shape: diam}


用户输入可控制：1.userid 2.sessionid 3.检索模式（向量数据库rag、图数据库rag、混合rag、不检索） 4.问题

工具
1.crawl4ai爬虫
2.langmem管理工具